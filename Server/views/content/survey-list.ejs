<div class="container" style="margin-top: 50px;">
<h1 style="text-align: center;"><%= title %></h1>

 <div class="row">
    <div class="col">
       
        <a href="/survey-list/add-survey" id="addButton" class="btn btn-primary mb-1"><i class="fas fa-plus-circle"></i> Create Survey</a>      
        <table class="table table-striped table-bordered table-hover" style="margin-top: 20px;">
            <thead class="table-dark">
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Survey Name</th>
                    <th scope="col">Start Date</th>
                    <th scope="col">Expiry Date</th>
                    <th scope="col">Author</th>
                    <th></th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <% for(let count = 0; count < list.length; count++) { %>
                    
                    <!-- Repeatable Row Template -->
                    <tr>           
                        <td><%= count + 1 %></td>
                        <td><%= list[count].title %></td>
                        <td><%= list[count].start_Date %></td>  
                        <td><%= list[count].end_Date %></td>
                        <td><%= list[count].author %></td>  

                        <td class="text-center">                                                     
                        <button type="button" class="btn btn-success" data-bs-toggle="collapse" data-bs-target="#collapseExample<%= count + 1 %>" aria-expanded="false" aria-controls="collapseExample"><i class="fas fa-edit fa-sm"></i> Show Details</button>
                        </td>  
                                                                          
                        <td class="text-center"><a href="/question/<%= list[count]._id %>" class="btn btn-primary btn edit"><i class="fas fa-edit fa-sm"></i> Edit Survey</a></td>                                                                           
                        <td class="text-center"><a href="/survey-list/delete-survey/<%= list[count]._id %>" class="btn btn-danger btn delete"><i class="fas fa-trash-alt fa-sm"></i> Delete</a></td>
                    </tr> 
                     <tr>
                        <td colspan="8">
                            <div class="collapse" id="collapseExample<%= count + 1 %>">    
                                
                          <!-------------------------------Details start here------------------------------------>
                          <div class="row" name="example">
              
                            <% for(let count2 = 0; count2 < list2.length; count2++) { %>
                              <% if(list2[count2].survey_id == list[count]._id) {%> 
                              <div class="col-md-6">     
                                <table class="table table-bordered">                                                                                
                                    <thead style="text-align: center">
                                      <tr>
                                        <th scope="row">                                         
                                          <%= list2[count2].questionText %>
                                        </th>
                                        <td>Count</td>
                                      </tr>
                                    </thead>

                                    <tbody style="text-align:center">
                                      <% let firstOptionCount = 0 %>
                                      <% let secondOptionCount = 0 %> 
                                      <% let thirdOptionCount = 0 %> 
                                      <% let fourthOptionCount = 0 %>
                                      
                                      <!--Search all the response list-->  
                                      <% for(let count3 = 0; count3 < list3.length; count3++) {%> 
                                        <!--Find if the response belongs to this survey-->
                                       <% if(list3[count3].survey_id == list[count]._id) {%>
                                        <!--Search all the response submitted-->
                                        <% for(let count4 = 0; count4 < Object.values(JSON.parse(list3[count3].question.option)).length; count4++) {%>           
                                          <% if((Object.keys(JSON.parse(list3[count3].question.option))[count4]) == list2[count2].questionText) {%>
                                          <% switch (Object.values(JSON.parse(list3[count3].question.option))[count4]) {
                                            
                                            case list2[count2].first_Choice : %>
                                            <% firstOptionCount++ %>
                                                    <% break;
                                            
                                            case list2[count2].second_Choice : %>
                                            <%secondOptionCount++%>
                                                    <% break;
                                            
                                            case list2[count2].third_Choice : %>
                                            <%thirdOptionCount++%>
                                                    <% break;

                                            case list2[count2].fourth_Choice : %>
                                            <%fourthOptionCount++ %>
                                                    <% break;

                                            default: %>
                                              <% break;

                                            } %>
                                        <% } %> 
                                        <% } %>
                                        <% } %>
                                        <% } %>
                                      <tr>
                                        <th scope="row"><%=list2[count2].first_Choice %></th>                             
                                        <td><%= firstOptionCount %></td>
                                      </tr>

                                      <tr>
                                        <th scope="row"><%=list2[count2].second_Choice %></th>
                                        <td><%= secondOptionCount %></td>
                                       
                                      </tr>

                                      <tr>
                                        <th scope="row"> <%=list2[count2].third_Choice %></th>
                                        <td><%= thirdOptionCount %></td>                                      
                                      </tr>

                                      <tr>
                                        <th scope="row"><%=list2[count2].fourth_Choice %></th>
                                        <td><%= fourthOptionCount %></td>                                      
                                      </tr>
                                    
                                    </tbody>
                                  </table>
                                    </div>                                                                                                  
                                    <% } %> 
                                    <% } %>                                  
                          </div>                     
                                                                                                               
                      <!---------------------------------Details stop here---------------------------------->     
                          </div> 
                        </td>      
                    </tr> 
                    <% }  %>                
            </tbody>      
  
               
        </table>

    </div>
  </div>
</div>
    

